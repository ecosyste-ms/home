<%= render 'accounts/header' %>

<div class="container">
  <div class="row">
    <div class="col-12 col-lg-3">
      <%= render 'accounts/navigation' %>
    </div>
    <div class="col-12 col-lg-9">
      <h1 class="mb-4">Password and security</h1>

      <% github_identity = @identities.find { |i| i.provider == 'github' } %>
      <% if github_identity %>
        <div class="alert alert-info" role="alert">
          Your account is linked to GitHub, change your password or security settings in your <a href="https://github.com/settings/security">GitHub Account</a>.
        </div>
      <% end %>

      <% single_identity = @identities.size == 1 %>

      <h2 class="mb-4 mt-5">
        <%= single_identity ? "Your connected account" : "Manage connected accounts" %>
      </h2>

      <div class="list-group">
        <% @identities.each do |identity| %>
          <div class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <p class="mb-1">
                <%= bootstrap_icon identity.icon_name, width: 20, height: 20, class: "me-1" %>
                <strong><%= identity.display_name %></strong>
              </p>
              <p class="mb-0 small">
                <% if identity.username %>
                  @<%= identity.username %>
                <% elsif identity.email %>
                  <%= identity.email %>
                <% else %>
                  Connected through your <%= identity.display_name.downcase %> account
                <% end %>
              </p>
              <% if single_identity %>
                <p class="mt-2 text-muted small mb-1">
                  This is your only connected account and can&apos;t be unlinked.
                </p>
              <% end %>
            </div>
            <div>
              <% if identity.can_unlink? && !single_identity %>
                <%= button_to 'Unlink', unlink_identity_account_path(identity_id: identity.id),
                      method: :delete,
                      class: 'btn btn-sm btn-outline-danger',
                      data: { confirm: "Are you sure you want to unlink #{identity.display_name}?" } %>
              <% else %>
                <span class="badge text-bg-info">Primary</span>
              <% end %>
            </div>
          </div>
        <% end %>

        <% unless github_identity.present? %>
          <div class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <p class="mb-1">
                <%= bootstrap_icon 'github', width: 20, height: 20, class: 'me-1' %>
                <strong>GitHub</strong>
              </p>
              <p class="mb-0 text-muted small">Connect your GitHub account to log in easily</p>
            </div>
            <%= button_to auth_path('github'),
                  method: :post,
                  class: "btn btn-sm btn-outline-dark",
                  data: { turbo: false } do %>
              <%= bootstrap_icon 'github', width: 16, height: 16, class: 'me-1' %>
              Connect GitHub
            <% end %>
          </div>
        <% end %>
      </div>
      
    </div>
  </div>
</div>
